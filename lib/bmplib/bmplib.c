/*
    BMP2C Version 1.1
	 
   1.2 - Peut générer un tableau de short (utile pour DSP 5502)
	1.1 - Gestion des caractères en 6x8 sur certains LCD
   1.0 - Version initiale
*/

#include <stdio.h>
#include <string.h>
#include <malloc.h>
#include <conio.h>

const unsigned long image[] = {
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x04100800, 0x00007900, 0x08400000, 0x00000000, 0x0000070c, 
   0x02200900, 0x00004500, 0x0c400000, 0x00000000, 0x00000884, 
   0x02238bdc, 0x3c604560, 0x0a400000, 0x00000000, 0x00000884, 
   0x02244902, 0x44904590, 0x0a400000, 0x00000000, 0x00000884, 
   0x0144490e, 0x44f07913, 0xc9400000, 0x00000000, 0x00000884, 
   0x01444912, 0x44804110, 0x09400000, 0x00000000, 0x00000884, 
   0x01444912, 0x4c804110, 0x08c00000, 0x00000000, 0x00000884, 
   0x008388cf, 0x34704110, 0x08400000, 0x00000000, 0x00000704, 
   0x00000000, 0x04000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x78000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x000001f8, 0x07e007c0, 0x0001c000, 0x00000000, 
   0x00000000, 0x000007fc, 0x0ff01ff0, 0x0003c000, 0x00000000, 
   0x00000000, 0x00000ffe, 0x1ff81ff0, 0x0007c000, 0x00000000, 
   0x00000000, 0x00000f1f, 0x3e7c3c78, 0x000fc000, 0x00000000, 
   0x00000000, 0x00001e0f, 0x3c3c3c78, 0x003fc000, 0x00000000, 
   0x20980000, 0x00001e0f, 0x003c783c, 0x007fc000, 0x00000000, 
   0x11080000, 0x0000000f, 0x0078783c, 0x007bc000, 0x00000000, 
   0x11080000, 0x0000000f, 0x01f8783c, 0x0073c000, 0x00000000, 
   0x11080000, 0x0000001e, 0x01e0783c, 0x0043c000, 0x00000000, 
   0x0a080000, 0x0000003e, 0x01f8783c, 0x0003c000, 0x00000000, 
   0x0a080000, 0x0000007c, 0x003c783c, 0x0003c000, 0x00000000, 
   0x0a080000, 0x000000f8, 0x001e783c, 0x0003c000, 0x00000000, 
   0x04080000, 0x000001f0, 0x001e783c, 0x0003c000, 0x82000000, 
   0x00000000, 0x000003e0, 0x001e783c, 0x0003c000, 0x44000000, 
   0x00000000, 0x000007c0, 0x3c1e783c, 0x0003c000, 0x44000000, 
   0x00000000, 0x00000780, 0x3c1e3c78, 0x0003c000, 0x44000000, 
   0x00000000, 0x00000f00, 0x1e3c3c78, 0x7803c000, 0x28000000, 
   0x00000000, 0x00000fff, 0x1ffc1ff0, 0x7803c000, 0x28000000, 
   0x00000000, 0x00001fff, 0x0ff81ff0, 0x7803c000, 0x28000000, 
   0x00000000, 0x00001fff, 0x03e007c0, 0x7803c000, 0x10000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x000001f8, 0x03f007c0, 0x001fc000, 0x00000000, 
   0x00000000, 0x000007fc, 0x0ff81fe0, 0x003fe000, 0x00000000, 
   0x00000000, 0x00000ffe, 0x1ffc3ff0, 0x007ff000, 0x00000000, 
   0x00000000, 0x00000f1f, 0x1e3e3c78, 0x00f8f800, 0x00000000, 
   0x00000000, 0x00001e0f, 0x3c1e7838, 0x00f07800, 0x00000000, 
   0x00000000, 0x00001e0f, 0x3c1e783c, 0x00f07800, 0x00000000, 
   0x41380000, 0x0000000f, 0x001e783c, 0x00f07800, 0x00000000, 
   0x22440000, 0x0000000f, 0x001e783c, 0x0078f000, 0x00000000, 
   0x22040000, 0x0000001e, 0x003c783c, 0x003fe000, 0x00000000, 
   0x22080000, 0x0000003e, 0x007c3c7c, 0x001fc000, 0x00000000, 
   0x14100000, 0x0000007c, 0x00f83ffc, 0x003fe000, 0x00000000, 
   0x14200000, 0x000000f8, 0x01f01ffc, 0x0078f000, 0x82000000, 
   0x14400000, 0x000001f0, 0x03e00fbc, 0x00f07800, 0x44000000, 
   0x087c0000, 0x000003e0, 0x07c0003c, 0x00f07800, 0x44000000, 
   0x00000000, 0x000007c0, 0x0f800038, 0x00f07800, 0x44000000, 
   0x00000000, 0x00000780, 0x0f007878, 0x00f07800, 0x28000000, 
   0x00000000, 0x00000f00, 0x1e007c78, 0x78f8f800, 0x28000000, 
   0x00000000, 0x00000fff, 0x1ffe3ff0, 0x787ff000, 0x28000000, 
   0x00000000, 0x00001fff, 0x3ffe3fe0, 0x783fe000, 0x10000000, 
   0x00000000, 0x00001fff, 0x3ffe0f80, 0x780f8000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x000001f8, 0x07e000e0, 0x000f8000, 0x00000000, 
   0x00000000, 0x000007fc, 0x0ff001e0, 0x003fe000, 0x00000000, 
   0x00000000, 0x00000ffe, 0x1ff803e0, 0x003fe000, 0x00000000, 
   0x00000000, 0x00000f1f, 0x3e7c07e0, 0x0078f000, 0x00000000, 
   0x00000000, 0x00001e0f, 0x3c3c1fe0, 0x0078f000, 0x00000000, 
   0x00000000, 0x00001e0f, 0x003c3fe0, 0x00f07800, 0x00000000, 
   0x209c0000, 0x0000000f, 0x00783de0, 0x00f07800, 0x00000000, 
   0x11220000, 0x0000000f, 0x01f839e0, 0x00f07800, 0x00000000, 
   0x11020000, 0x0000001e, 0x01e021e0, 0x00f07800, 0x00000000, 
   0x111c0000, 0x0000003e, 0x01f801e0, 0x00f07800, 0x00000000, 
   0x0a020000, 0x0000007c, 0x003c01e0, 0x00f07800, 0x82000000, 
   0x0a020000, 0x000000f8, 0x001e01e0, 0x00f07800, 0x44000000, 
   0x0a220000, 0x000001f0, 0x001e01e0, 0x00f07800, 0x44000000, 
   0x041c0000, 0x000003e0, 0x001e01e0, 0x00f07800, 0x44000000, 
   0x00000000, 0x000007c0, 0x3c1e01e0, 0x00f07800, 0x28000000, 
   0x00000000, 0x00000780, 0x3c1e01e0, 0x0078f000, 0x28000000, 
   0x00000000, 0x00000f00, 0x1e3c01e0, 0x7878f000, 0x28000000, 
   0x00000000, 0x00000fff, 0x1ffc01e0, 0x783fe000, 0x10000000, 
   0x00000000, 0x00001fff, 0x0ff801e0, 0x783fe000, 0x00000000, 
   0x00000000, 0x00001fff, 0x03e001e0, 0x780f8000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x000007c0, 0x000fc000, 0x00000000, 
   0x00000000, 0x00000000, 0x00001ff0, 0x003fe000, 0x00000000, 
   0x00000000, 0x00000000, 0x00001ff0, 0x007ff000, 0x00000000, 
   0x00000000, 0x00000000, 0x00003c78, 0x0078f800, 0x00000000, 
   0x00000000, 0x00000000, 0x00003c78, 0x00f07800, 0x00000000, 
   0x00000000, 0x00000000, 0x0000783c, 0x00f07800, 0x00000000, 
   0x00000000, 0x00000000, 0x0000783c, 0x00007800, 0x00000000, 
   0x20ff0000, 0x00000000, 0x0000783c, 0x00007800, 0x00000000, 
   0x11080000, 0x00000000, 0x0000783c, 0x0000f000, 0x00000000, 
   0x11080000, 0x00000000, 0x0000783c, 0x0001f000, 0x00000000, 
   0x11080000, 0x00000000, 0x0000783c, 0x0003e000, 0x00000000, 
   0x0a080000, 0x00000000, 0x0000783c, 0x0007c000, 0x00000000, 
   0x0a080000, 0x00000000, 0x0000783c, 0x000f8000, 0x82000000, 
   0x0a080000, 0x00000000, 0x0000783c, 0x001f0000, 0x44000000, 
   0x04080000, 0x00000000, 0x0000783c, 0x003e0000, 0x44000000, 
   0x00000000, 0x00000000, 0x00003c78, 0x003c0000, 0x44000000, 
   0x00000000, 0x00000000, 0x00003c78, 0x78780000, 0x28000000, 
   0x00000000, 0x00000000, 0x00001ff0, 0x787ff800, 0x28000000, 
   0x00000000, 0x00000000, 0x00001ff0, 0x78fff800, 0x28000000, 
   0x00000000, 0x00000000, 0x000007c0, 0x78fff800, 0x10000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
   0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000004, 0x00000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000086, 0x20000000, 0x00000000, 0x00000000, 
   0x00000000, 0x0000005f, 0x40000000, 0x00000073, 0x9cc00000, 
   0x00000000, 0x000000a6, 0xa0000000, 0x0000008c, 0x63000000, 
   0x00000000, 0x00000195, 0x30000000, 0x00000014, 0xa5000000, 
   0x00000000, 0x0000030a, 0x18000000, 0x00000025, 0x29000000, 
   0x00000000, 0x00000304, 0x18000000, 0x00000025, 0x29000000, 
   0x00000000, 0x0000030a, 0x18000000, 0x00000025, 0x29000000, 
   0x00000000, 0x00000191, 0x30000000, 0x00000025, 0x29000000, 
   0x00000000, 0x000000a0, 0xa0000000, 0x00000018, 0xc6000000, 
   0x00000000, 0x0000004e, 0x40000000, 0x00000000, 0x00000000, 
   0x00000000, 0x00000080, 0x20000000, 0x00000000, 0x00000000, 
   0xaa000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055
};


typedef struct {
   unsigned short int type;                 /* Magic identifier            */
   unsigned int size;                       /* File size in bytes          */
   unsigned short int reserved1, reserved2;
   unsigned int offset;                     /* Offset to image data, bytes */
} HEADER;

typedef struct {
   unsigned int size;               /* Header size in bytes      */
   int width,height;                /* Width and height of image */
   unsigned short int planes;       /* Number of colour planes   */
   unsigned short int bits;         /* Bits per pixel            */
   unsigned int compression;        /* Compression type          */
   unsigned int imagesize;          /* Image size in bytes       */
   int xresolution,yresolution;     /* Pixels per meter          */
   unsigned int ncolours;           /* Number of colours         */
   unsigned int importantcolours;   /* Important colours         */
   unsigned int rgb;
   unsigned int rgb2;
} INFOHEADER;

#define BF_TYPE 0x4D42             /* "MB" */

HEADER header;
INFOHEADER infoheader;

int main(int argv, char *argc[])
{
   FILE *fout;		// bmp généré
   int i, j;
	int taille, offset;
   size_t ret;
	unsigned char *scratch;
	
   header.type = BF_TYPE;
   header.size = 0xa3e;
   header.reserved1 = 0;
   header.reserved2 = 0;
   header.offset = 62;
   
   infoheader.size = 40;
   infoheader.width = 160;
   infoheader.height = 128;
   infoheader.planes = 1;
   infoheader.bits = 1;
   infoheader.compression = 0;
   infoheader.imagesize = 2560;
   infoheader.xresolution = 0;
   infoheader.yresolution = 0;
   infoheader.ncolours = 2;
   infoheader.importantcolours = 2;
   infoheader.rgb = 0;
   infoheader.rgb2 = 0xffffff;

   if((fout=fopen("essai.bmp","wb"))==NULL) {
      printf("Error!");
      return (0);
   }

   taille = 2560;
   scratch = (unsigned char*)malloc( taille*sizeof(unsigned char) );
	if( scratch == NULL ) {
		printf("Memory allocation error. Exiting...\n");
		return 2;
	}

   for( i=0; i<128; i++ ) {
      for( j=0; j<5; j++ ) {
         offset = taille/4+j-5*i-5;
         scratch[20*i+4*j] = ~(unsigned char)(image[offset]>>24);
         scratch[20*i+4*j+1] = ~(unsigned char)(image[offset]>>16);
         scratch[20*i+4*j+2] = ~(unsigned char)(image[offset]>>8);
         scratch[20*i+4*j+3] = ~(unsigned char)(image[offset]&0xff);
      }
   }

   ret = fwrite(&header, sizeof(char), sizeof(HEADER), fout );
   ret = fwrite(&infoheader, sizeof(char), sizeof(INFOHEADER), fout );
   ret = fwrite(scratch, sizeof(unsigned char), taille, fout );
   
   fclose(fout);
	free( scratch );
   return (0);
}

